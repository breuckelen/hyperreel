# @package _group_

type: lightfield

render:
  type: lightfield

param:
  n_dims: 6
  fn: identity


### EMBEDDING ###
embedding:
  type: ray_point

  embeddings:
    ray_prediction_0:
      type: ray_prediction

      # Parameterization
      params:
        points:
          start: 0
          end: 7

          param:
            n_dims: 3
            fn: depth

          pe:
            type: basic
            n_freqs: 2

        ray:
          start: 0
          end: 6

          param:
            n_dims: 4
            fn: two_plane

          pe:
            type: basic
            n_freqs: 1

      # Net
      net:
        type: base
        group: embedding_impl

        depth: 6
        hidden_channels: 256
        skips: [3]

      # Outputs
      z_channels: 32

      outputs:
        z_vals:
          channels: 1

        sigma:
          channels: 1

          activation:
            type: ease_in_value
            start_value: 1.0
            window_epochs: 3
            wait_epochs: 0

            activation:
              type: sigmoid
              shift: 4.0

        point_sigma:
          channels: 1

          activation:
            type: ease_in_value
            start_value: 1.0
            window_epochs: 3
            wait_epochs: 0

            activation:
              type: sigmoid
              shift: 4.0

        point_offset:
          channels: 3

          activation:
            type: tanh
            outer_fac: 0.25

      ray_outputs: # TODO: Remove
        color_scale:
          channels: 3

          activation:
            type: ease_in_value
            start_value: 0.0
            window_epochs: 0
            wait_epochs: 0

            activation:
              type: identity
              shift: 0.0
              inner_fac: 1.0
              outer_fac: 1.0

        color_shift:
          channels: 3

          activation:
            type: ease_in_value
            start_value: 0.0
            window_epochs: 0
            wait_epochs: 0

            activation:
              type: identity
              shift: 0.0
              inner_fac: 1.0
              outer_fac: 1.0

    ray_intersect_0:
      type: ray_intersect

      # Intersect
      z_channels: 32

      intersect:
        type: z_plane

        sort: True
        sort_outputs: [point_sigma, point_offset, color_scale, color_shift]

        use_sigma: True

        out_points: raw_points
        out_distance: raw_distance

        initial: -1.0
        end: 1.0

        activation:
          type: tanh
          inner_fac: 0.25
          outer_fac: 4.0

    point_offset_0:
      type: point_offset
      use_sigma: True

    add_point_outputs_0:
      type: add_point_outputs
      extra_outputs: ['viewdirs']

    extract_fields:
      type: extract_fields
      fields: ['point_offset', 'points', 'distances', 'viewdirs', 'weights', 'color_scale', 'color_shift']

### COLOR ###
color:
  type: base

  net:
    type: ngp_rf

    white_bg: 0
    black_bg: 0

    aabb: [-2.0, -2.0, -2.0, 2.0, 2.0, 2.0]
    #aabb: [-1.5, -1.5, -1.5, 1.5, 1.5, 1.5]

    num_dim: 3

    use_viewdirs: True
    #use_viewdirs: False

    hidden_dim: 64
    geo_feat_dim: 15

    density_activation: relu

    distance_scale: 8.0

    #window_epochs: 0
    window_epochs: 1

    n_window_levels: 16
    #n_window_levels: 8
    #n_window_levels: 6

    window_discrete: False
    #window_discrete: True

    #window_start_level: 8
    window_start_level: 16

    n_levels: 16

    base_res: 16
    #base_res: 32

    max_res: 1024
    #max_res: 2048

    log2_hashmap_size: 16
    #log2_hashmap_size: 19